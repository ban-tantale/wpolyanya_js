<!DOCTYPE html>
<html>

<body>
    <div id="error" style="color:red"></div>
    <canvas id="myCanvas" width="800" height="6s00" style="border:thick solid grey; float:left"></canvas>

    <div id="debug"></div>
    <div id="log" style="border-style: dotted;"></div>

    <script src="debug.js"></script>
    <script src="maps.js"></script>
    <script src="geometry.js"></script>
    <script src="camera.js"></script>
    <script src="test_succs.js"></script>
    <script src="search.js"></script>
    <script>

        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#FF0000';
        canvas.height = canvas.width;
        ctx.transform(1, 0, 0, -1, 0, canvas.height)

        const camera = new Camera(ctx);
        camera.set_path_width(5);

        function click(event) {
            const canvas = document.getElementById('myCanvas');
            canvas.style.border = "thick solid #ff0000";
            try {
                const p = camera.point_of_event(event);
                log('Click: ' + p);
                test_click(event);
                canvas.style.border = "thick solid grey";
            } catch (e) {
                debug_error("Error: " + e);
            }
        }
        canvas.addEventListener('click', click);

        function deal_with_keys(event) {
            let modified = false;
            if (event.code == 'ArrowLeft') { camera.left(); }
            else if (event.code == 'ArrowRight') { camera.right(); }
            else if (event.code == 'ArrowUp') { camera.up(); }
            else if (event.code == 'ArrowDown') { camera.down(); }
            else if (event.shiftKey && (event.code == 'KeyZ')) { camera.unzoom(); }
            else if (event.code == 'KeyZ') { camera.zoom(); }
            else {
                return;
            }

            camera.clear();
            camera.draw_map(map);
        }
        onkeyup = deal_with_keys;

        const pp = complex_map();
        const map = new Map(pp[0], pp[1]);
        camera.compute_weight_colours(map);
        camera.draw_map(map);

        window.alert('coucou');
    </script>

</body>

</html>